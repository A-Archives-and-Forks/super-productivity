<div class="wrapper mat-elevation-z1">
  <help-section>
    <p>{{ T.F.METRIC.EVAL_FORM.HELP_P1 | translate }}</p>
    <p>
      <a routerLink="/metrics">{{ T.F.METRIC.EVAL_FORM.HELP_LINK_TXT | translate }}</a>
    </p>

    <h3 class="mat-h3">{{ T.F.METRIC.EVAL_FORM.HELP_H1 | translate }}</h3>
    <p>{{ T.F.METRIC.EVAL_FORM.HELP_P2 | translate }}</p>
  </help-section>

  @if (metricForDay) {
    <form
      #f="ngForm"
      name="form"
      novalidate
    >
      <div class="radio-group">
        <label>{{ T.F.METRIC.EVAL_FORM.IMPACT_OF_WORK | translate }}</label>
        <mat-radio-group
          #impactOfWork="ngModel"
          (ngModelChange)="updateImpactOfWork($event)"
          [ngModel]="metricForDay.impactOfWork"
          name="impactOfWork"
        >
          @for (value of [1, 2, 3, 4]; track value) {
            <mat-radio-button [value]="value">{{ value }}</mat-radio-button>
          }
        </mat-radio-group>
        <div class="hint">{{ T.F.METRIC.EVAL_FORM.IMPACT_OF_WORK_HINT | translate }}</div>
      </div>

      <div class="radio-group">
        <label>{{ T.F.METRIC.EVAL_FORM.ENERGY_LEVEL | translate }}</label>
        <mat-radio-group
          #energyCheckin="ngModel"
          (ngModelChange)="updateEnergyCheckin($event)"
          [ngModel]="metricForDay.energyCheckin"
          name="energyCheckin"
        >
          <mat-radio-button [value]="1">üò´</mat-radio-button>
          <mat-radio-button [value]="2">üòê</mat-radio-button>
          <mat-radio-button [value]="3">üòä</mat-radio-button>
        </mat-radio-group>
        <div class="hint">{{ T.F.METRIC.EVAL_FORM.ENERGY_LEVEL_HINT | translate }}</div>
      </div>

      <div class="time-summary">
        <div class="time-item">
          <label>{{ T.F.METRIC.EVAL_FORM.FOCUS_WORK_TIME | translate }}</label>
          <span class="time-display">{{ deepWorkTime | msToClockString }}</span>
        </div>

        <div class="time-item">
          <label>{{ T.F.METRIC.EVAL_FORM.TOTAL_WORK_TIME | translate }}</label>
          <span class="time-display">{{ totalWorkTimeMs | msToClockString }}</span>
        </div>
      </div>

      <div class="scores-container">
        <div
          class="score-card productivity"
          [style.background]="getScoreColor(productivityScore)"
        >
          <div class="label">
            {{ T.F.METRIC.EVAL_FORM.PRODUCTIVITY_SCORE | translate }}
          </div>
          <div class="score">{{ productivityScore }}</div>
        </div>

        <div
          class="score-card sustainability"
          [style.background]="getScoreColor(sustainabilityScore)"
        >
          <div class="label">
            {{ T.F.METRIC.EVAL_FORM.SUSTAINABILITY_SCORE | translate }}
          </div>
          <div class="score">{{ sustainabilityScore }}</div>
        </div>
      </div>

      @if (sevenDayAverage$ | async; as sevenDayAverage) {
        <button
          type="button"
          class="seven-day-summary"
          (click)="openProductivityBreakdown()"
        >
          <div class="summary-label">7-Day Average:</div>
          <div class="summary-value">{{ sevenDayAverage }}</div>
          @if (productivityTrend$ | async; as trend) {
            <div
              class="trend-indicator"
              [class]="'trend-' + trend.direction"
            >
              @if (trend.direction === 'up') {
                <mat-icon>trending_up</mat-icon>
                <span>+{{ trend.change }} ({{ trend.changePercent }}%)</span>
              } @else if (trend.direction === 'down') {
                <mat-icon>trending_down</mat-icon>
                <span>{{ trend.change }} ({{ trend.changePercent }}%)</span>
              } @else {
                <mat-icon>trending_flat</mat-icon>
                <span>Stable</span>
              }
            </div>
          }
        </button>
      }

      <!--      <section class="notes-for-tomorrow">-->
      <!--        <h3 class="section-title">-->
      <!--          {{ T.F.METRIC.EVAL_FORM.NOTES_SECTION_TITLE | translate }}-->
      <!--        </h3>-->
      <!--        <mat-form-field>-->
      <!--          <mat-label>{{ T.F.METRIC.EVAL_FORM.NOTES | translate }}</mat-label>-->
      <!--          <textarea-->
      <!--            #notes="ngModel"-->
      <!--            (ngModelChange)="updateNotes($event)"-->
      <!--            [ngModel]="metricForDay.notes"-->
      <!--            matInput-->
      <!--            name="notes"-->
      <!--            rows="4"-->
      <!--          ></textarea>-->
      <!--        </mat-form-field>-->

      <!--        <div class="checkbox-container">-->
      <!--          <mat-checkbox-->
      <!--            #remindTomorrow="ngModel"-->
      <!--            (ngModelChange)="updateRemindTomorrow($event)"-->
      <!--            [ngModel]="metricForDay.remindTomorrow"-->
      <!--            name="remindTomorrow"-->
      <!--          >-->
      <!--            {{ T.F.METRIC.EVAL_FORM.REMIND_TOMORROW | translate }}-->
      <!--          </mat-checkbox>-->
      <!--        </div>-->
      <!--      </section>-->
    </form>
  }
</div>
@if (workContextService.isActiveWorkContextProject$ | async) {
  <div style="text-align: center; margin-top: 8px; margin-bottom: 16px">
    <button
      (click)="addNote()"
      mat-button
    >
      <mat-icon>add</mat-icon>
      {{ T.F.METRIC.EVAL_FORM.ADD_NOTE_FOR_TOMORROW | translate }}
    </button>
  </div>
}
