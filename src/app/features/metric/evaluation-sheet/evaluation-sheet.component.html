@if (metricForDay) {
  <div class="radio-group">
    <label>{{ T.F.METRIC.EVAL_FORM.IMPACT_OF_WORK | translate }}</label>
    <impact-stars
      #impactOfWork="ngModel"
      (ngModelChange)="updateImpactOfWork($event)"
      [ngModel]="metricForDay.impactOfWork || 0"
      name="impactOfWork"
      [maxStars]="4"
      ariaLabel="How impactful was your work today?"
      zeroLabel="No impact"
      lowLabel="Low impact"
      highLabel="High impact"
    ></impact-stars>
    <div class="hint">{{ T.F.METRIC.EVAL_FORM.IMPACT_OF_WORK_HINT | translate }}</div>
  </div>

  <div class="radio-group">
    <label>{{ T.F.METRIC.EVAL_FORM.ENERGY_LEVEL | translate }}</label>
    <mat-radio-group
      #energyCheckin="ngModel"
      (ngModelChange)="updateEnergyCheckin($event)"
      [ngModel]="metricForDay.energyCheckin"
      name="energyCheckin"
    >
      <mat-radio-button [value]="1">üò´</mat-radio-button>
      <mat-radio-button [value]="2">üòê</mat-radio-button>
      <mat-radio-button [value]="3">üòä</mat-radio-button>
    </mat-radio-group>
    <div class="hint">{{ T.F.METRIC.EVAL_FORM.ENERGY_LEVEL_HINT | translate }}</div>
  </div>

  @if (hasProductivityData || hasSustainabilityData) {
    <div class="scores-container">
      @if (hasProductivityData) {
        <div
          class="score-card productivity"
          [style.background]="getScoreColor(productivityScore)"
        >
          <div
            class="label"
            matTooltip="70% Impact Rating (1-4 scale) + 30% Progress toward 4h deep work target. Rewards meaningful work with diminishing returns beyond target."
            matTooltipPosition="above"
          >
            {{ T.F.METRIC.EVAL_FORM.PRODUCTIVITY_SCORE | translate }}
          </div>
          <div class="score-row">
            <div class="score">{{ productivityScore }}</div>
          </div>
          @if (productivitySummary$ | async; as summary) {
            @if (summary.average !== null) {
              <div class="trend-row">
                <button
                  type="button"
                  class="trend-pill"
                  (click)="openProductivityBreakdown()"
                  [ngClass]="getTrendClass(summary.trend)"
                >
                  <span class="pill-title">7d</span>
                  <span class="pill-value">{{ summary.average }}</span>
                  <span class="pill-delta">{{ getTrendDelta(summary.trend) }}</span>
                </button>
              </div>
            }
          }
        </div>
      }

      @if (hasSustainabilityData) {
        <div
          class="score-card sustainability"
          [style.background]="getScoreColor(sustainabilityScore)"
        >
          <div
            class="label"
            matTooltip="45% Energy Level + 40% Reasonable Work Hours (0 at 10h) + 15% Focus Balance (optimal at 4h). Prevents burnout and promotes sustainable work habits."
            matTooltipPosition="above"
          >
            {{ T.F.METRIC.EVAL_FORM.SUSTAINABILITY_SCORE | translate }}
          </div>
          <div class="score-row">
            <div class="score">{{ sustainabilityScore }}</div>
          </div>
          @if (sustainabilitySummary$ | async; as summary) {
            @if (summary.average !== null) {
              <div class="trend-row">
                <button
                  type="button"
                  class="trend-pill"
                  (click)="openProductivityBreakdown()"
                  [ngClass]="getTrendClass(summary.trend)"
                >
                  <span class="pill-title">7d</span>
                  <span class="pill-value">{{ summary.average }}</span>
                  <span class="pill-delta">{{ getTrendDelta(summary.trend) }}</span>
                </button>
              </div>
            }
          }
        </div>
      }
    </div>
  }

  @if (hasProductivityData || hasSustainabilityData) {
    <div class="daily-state-card">
      <div
        class="daily-state-label"
        matTooltip="Quadrant system based on both scores (‚â•50 is high): Deep Flow (high/high), Overdrive (high/low), Recovery (low/high), Drift (low/low)"
        matTooltipPosition="above"
      >
        {{ T.F.METRIC.EVAL_FORM.DAILY_STATE | translate }}
      </div>
      <div class="daily-state-title">
        <span class="daily-state-icon">{{ dailyStateInfo.icon }}</span>
        <span>{{ dailyStateInfo.headlineKey | translate }}</span>
      </div>
      <div class="daily-state-hint">{{ dailyStateInfo.hintKey | translate }}</div>
    </div>
  }

  <div class="time-summary">
    <div class="time-item">
      <span class="time-label">{{
        T.F.METRIC.EVAL_FORM.FOCUS_WORK_TIME | translate
      }}</span>
      <span class="time-value">{{ deepWorkTime | msToClockString }}</span>
    </div>

    <div class="time-item">
      <span class="time-label">{{
        T.F.METRIC.EVAL_FORM.TOTAL_WORK_TIME | translate
      }}</span>
      <span class="time-value">{{ totalWorkTimeMs | msToClockString }}</span>
    </div>
  </div>

  <!--      <section class="notes-for-tomorrow">-->
  <!--        <h3 class="section-title">-->
  <!--          {{ T.F.METRIC.EVAL_FORM.NOTES_SECTION_TITLE | translate }}-->
  <!--        </h3>-->
  <!--        <mat-form-field>-->
  <!--          <mat-label>{{ T.F.METRIC.EVAL_FORM.NOTES | translate }}</mat-label>-->
  <!--          <textarea-->
  <!--            #notes="ngModel"-->
  <!--            (ngModelChange)="updateNotes($event)"-->
  <!--            [ngModel]="metricForDay.notes"-->
  <!--            matInput-->
  <!--            name="notes"-->
  <!--            rows="4"-->
  <!--          ></textarea>-->
  <!--        </mat-form-field>-->

  <!--        <div class="checkbox-container">-->
  <!--          <mat-checkbox-->
  <!--            #remindTomorrow="ngModel"-->
  <!--            (ngModelChange)="updateRemindTomorrow($event)"-->
  <!--            [ngModel]="metricForDay.remindTomorrow"-->
  <!--            name="remindTomorrow"-->
  <!--          >-->
  <!--            {{ T.F.METRIC.EVAL_FORM.REMIND_TOMORROW | translate }}-->
  <!--          </mat-checkbox>-->
  <!--        </div>-->
  <!--      </section>-->
}

@if (workContextService.isActiveWorkContextProject$ | async) {
  <div style="text-align: center; margin-top: 8px; margin-bottom: 16px">
    <button
      (click)="addNote()"
      mat-button
    >
      <mat-icon>add</mat-icon>
      {{ T.F.METRIC.EVAL_FORM.ADD_NOTE_FOR_TOMORROW | translate }}
    </button>
  </div>
}
