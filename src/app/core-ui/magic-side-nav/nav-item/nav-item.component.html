@if (mode() === 'work' && workContext()) {
  <div
    class="planner-drag-place-holder-shared"
    *cdkDragPlaceholder
  ></div>

  <button
    #routeBtn
    [routerLink]="[type() === 'TAG' ? 'tag' : 'project', workContext()!.id, 'tasks']"
    routerLinkActive="active"
    [class]="rowClass()"
    [attr.title]="!showLabels() ? workContext()!.title : null"
    mat-menu-item
  >
    <mat-icon class="nav-icon drag-handle">{{
      workContext()!.icon || defaultIcon()
    }}</mat-icon>
    <span
      class="nav-label"
      [class.label-hidden]="!showLabels()"
      [attr.aria-hidden]="!showLabels() ? 'true' : 'false'"
    >
      {{ workContext()!.title }}
    </span>
    <span class="badge">{{ nrOfOpenTasks() }}</span>
  </button>

  <button
    [style.visibility]="showMoreButton() ? 'visible' : 'hidden'"
    #settingsBtn
    class="additional-btn"
    mat-icon-button
  >
    <mat-icon>more_vert</mat-icon>
  </button>

  <context-menu
    [contextMenu]="contextMenu"
    [rightClickTriggerEl]="routeBtn"
    [leftClickTriggerEl]="settingsBtn"
  ></context-menu>

  <ng-template #contextMenu>
    <work-context-menu
      [contextId]="workContext()!.id"
      [contextType]="type()!"
    ></work-context-menu>
  </ng-template>
} @else {
  <!-- Container + presentational row unified here -->
  @if (container() === 'route') {
    <a
      [routerLink]="navRoute()"
      routerLinkActive="active"
      mat-menu-item
      [class]="rowClass()"
      [class.expanded]="expanded()"
      [attr.title]="!showLabels() ? (label() | translate) : null"
      (click)="clicked.emit()"
    >
      @if (svgIcon()) {
        <mat-icon
          class="nav-icon"
          [svgIcon]="svgIcon()"
        ></mat-icon>
      } @else if (icon()) {
        <mat-icon class="nav-icon">{{ icon() }}</mat-icon>
      }
      @if (label()) {
        <span
          class="nav-label"
          [class.label-hidden]="!showLabels()"
          [attr.aria-hidden]="!showLabels() ? 'true' : 'false'"
        >
          {{ label() | translate }}
        </span>
      }
      @if (showChevron()) {
        <svg
          class="nav-chevron"
          width="16"
          height="16"
          viewBox="0 0 16 16"
          fill="none"
          stroke="currentColor"
          stroke-width="2"
        >
          <path d="M4 6l4 4 4-4" />
        </svg>
      }
    </a>
  } @else if (container() === 'href') {
    <a
      [href]="navHref()"
      target="_blank"
      mat-menu-item
      rel="noopener noreferrer"
      [class]="rowClass()"
      [class.expanded]="expanded()"
      [attr.title]="!showLabels() ? (label() | translate) : null"
      (click)="clicked.emit()"
    >
      @if (svgIcon()) {
        <mat-icon
          class="nav-icon"
          [svgIcon]="svgIcon()"
        ></mat-icon>
      } @else if (icon()) {
        <mat-icon class="nav-icon">{{ icon() }}</mat-icon>
      }
      @if (label()) {
        <span
          class="nav-label"
          [class.label-hidden]="!showLabels()"
          [attr.aria-hidden]="!showLabels() ? 'true' : 'false'"
        >
          {{ label() | translate }}
        </span>
      }
      @if (showChevron()) {
        <svg
          class="nav-chevron"
          width="16"
          height="16"
          viewBox="0 0 16 16"
          fill="none"
          stroke="currentColor"
          stroke-width="2"
        >
          <path d="M4 6l4 4 4-4" />
        </svg>
      }
    </a>
  } @else if (container() === 'action' || container() === 'group') {
    <button
      [class]="compact() ? 'nav-child-link' : 'nav-link'"
      mat-menu-item
      [class.expanded]="container() === 'group' && expanded()"
      [attr.title]="!showLabels() ? (label() | translate) : null"
      [attr.aria-expanded]="container() === 'group' ? ariaExpanded() : null"
      [attr.aria-controls]="container() === 'group' ? ariaControls() : null"
      (click)="clicked.emit()"
    >
      @if (svgIcon()) {
        <mat-icon
          class="nav-icon"
          [svgIcon]="svgIcon()"
        ></mat-icon>
      } @else if (icon()) {
        <mat-icon class="nav-icon">{{ icon() }}</mat-icon>
      }
      @if (label()) {
        <span
          class="nav-label"
          [class.label-hidden]="!showLabels()"
          [attr.aria-hidden]="!showLabels() ? 'true' : 'false'"
        >
          {{ label() | translate }}
        </span>
      }
      @if (showChevron()) {
        <svg
          class="nav-chevron"
          width="16"
          height="16"
          viewBox="0 0 16 16"
          fill="none"
          stroke="currentColor"
          stroke-width="2"
        >
          <path d="M4 6l4 4 4-4" />
        </svg>
      }
    </button>
  } @else {
    <!-- Fallback: raw row (kept for compatibility) -->
    @if (svgIcon()) {
      <mat-icon
        class="nav-icon"
        [svgIcon]="svgIcon()"
      ></mat-icon>
    } @else if (icon()) {
      <mat-icon class="nav-icon">{{ icon() }}</mat-icon>
    }

    @if (label()) {
      <span
        class="nav-label"
        [class.label-hidden]="!showLabels()"
        [attr.aria-hidden]="!showLabels() ? 'true' : 'false'"
      >
        {{ label() | translate }}
      </span>
    }

    @if (showChevron()) {
      <svg
        class="nav-chevron"
        width="16"
        height="16"
        viewBox="0 0 16 16"
        fill="none"
        stroke="currentColor"
        stroke-width="2"
      >
        <path d="M4 6l4 4 4-4" />
      </svg>
    }
  }
}
