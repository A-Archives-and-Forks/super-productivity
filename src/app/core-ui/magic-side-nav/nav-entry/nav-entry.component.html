<li
  class="nav-item"
  [class.has-children]="item.children && item.children.length > 0"
  role="listitem"
>
  <!-- Work Context Item (Today/Inbox using side-nav-item) -->
  @if (item.workContext && item.workContextType && item.defaultIcon && !item.children) {
    <side-nav-item
      [workContext]="item.workContext"
      [type]="item.workContextType"
      [defaultIcon]="item.defaultIcon"
      [activeWorkContextId]="activeWorkContextId || ''"
      class="work-context-item-main"
    ></side-nav-item>
  } @else if (item.route && (!item.children || item.children.length === 0)) {
    <!-- Simple route link -->
    <a
      [routerLink]="item.route"
      routerLinkActive="active"
      class="nav-link"
      [attr.title]="!showText ? item.label : null"
      (click)="onItemClick()"
    >
      <nav-row
        [icon]="item.icon"
        [svgIcon]="item.svgIcon"
        [label]="item.label"
        [badge]="item.badge"
        [showText]="showText"
      ></nav-row>
    </a>
  } @else if (item.href && (!item.children || item.children.length === 0)) {
    <!-- Simple href link -->
    <a
      [href]="item.href"
      target="_blank"
      rel="noopener noreferrer"
      class="nav-link"
      [attr.title]="!showText ? item.label : null"
      (click)="onItemClick()"
    >
      <nav-row
        [icon]="item.icon"
        [svgIcon]="item.svgIcon"
        [label]="item.label"
        [badge]="item.badge"
        [showText]="showText"
      ></nav-row>
    </a>
  }

  @if ((!item.route && !item.href) || (item.children && item.children.length > 0)) {
    <!-- Multi-button wrapper for expandable items with additional buttons -->
    @if (item.additionalButtons && item.additionalButtons.length > 0) {
      <nav-multi-btn
        [item]="item"
        [showText]="showText"
        [isGroupExpanded]="isGroupExpanded"
        (itemClick)="onItemClick()"
      ></nav-multi-btn>
    } @else {
      <!-- Single button for simple expandable items -->
      <button
        class="nav-link"
        [class.expanded]="isGroupExpanded"
        [attr.title]="!showText ? item.label : null"
        (click)="onItemClick()"
        [attr.aria-expanded]="isGroupExpanded"
        [attr.aria-controls]="'group-' + item.id"
      >
        <nav-row
          [icon]="item.icon"
          [svgIcon]="item.svgIcon"
          [label]="item.label"
          [badge]="item.badge"
          [showText]="showText"
          [showChevron]="item.children && item.children.length > 0 && showText"
        ></nav-row>
      </button>
    }
  }

  <!-- Children Items -->
  @if (item.children && item.children.length > 0) {
    <ul
      class="nav-children"
      [class.expanded]="isGroupExpanded"
      [class.visible]="isGroupExpanded"
      [attr.id]="'group-' + item.id"
      role="list"
    >
      @for (child of item.children; track child.id) {
        <!-- Use side-nav-item for work context items (projects/tags) -->
        @if (child.workContext && child.workContextType && child.defaultIcon) {
          <li
            class="nav-child-item work-context-item"
            role="listitem"
          >
            <side-nav-item
              [workContext]="child.workContext"
              [type]="child.workContextType"
              [defaultIcon]="child.defaultIcon"
              [activeWorkContextId]="activeWorkContextId || ''"
            ></side-nav-item>
          </li>
        } @else {
          <!-- Regular child link -->
          <li
            class="nav-child-item"
            role="listitem"
          >
            @if (child.route) {
              <a
                [routerLink]="child.route"
                routerLinkActive="active"
                class="nav-child-link"
                [attr.title]="!showText ? child.label : null"
                (click)="onChildClick(child)"
              >
                <nav-row
                  [icon]="child.icon"
                  [svgIcon]="child.svgIcon"
                  [label]="child.label"
                  [badge]="child.badge"
                  [showText]="true"
                ></nav-row>
              </a>
            } @else if (child.href) {
              <a
                [href]="child.href"
                target="_blank"
                rel="noopener noreferrer"
                class="nav-child-link"
                [attr.title]="!showText ? child.label : null"
                (click)="onChildClick(child)"
              >
                <nav-row
                  [icon]="child.icon"
                  [svgIcon]="child.svgIcon"
                  [label]="child.label"
                  [badge]="child.badge"
                  [showText]="true"
                ></nav-row>
              </a>
            } @else {
              <button
                class="nav-child-link"
                [attr.title]="!showText ? child.label : null"
                (click)="onChildClick(child)"
              >
                <nav-row
                  [icon]="child.icon"
                  [svgIcon]="child.svgIcon"
                  [label]="child.label"
                  [badge]="child.badge"
                  [showText]="true"
                ></nav-row>
              </button>
            }
          </li>
        }
      }
    </ul>
  }
</li>
