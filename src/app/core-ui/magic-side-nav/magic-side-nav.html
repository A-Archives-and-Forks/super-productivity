<!-- Mobile Menu Toggle (only visible on mobile) -->
@if (isMobile()) {
  <button
    class="mobile-menu-toggle"
    [class.visible]="isMobile()"
    (click)="toggleSidebar()"
    [attr.aria-label]="showMobileMenu() ? 'Close menu' : 'Open menu'"
    [attr.aria-expanded]="showMobileMenu()"
  >
    <svg
      width="24"
      height="24"
      viewBox="0 0 24 24"
      fill="none"
      stroke="currentColor"
      stroke-width="2"
    >
      @if (!showMobileMenu()) {
        <path d="M3 12h18M3 6h18M3 18h18" />
      }
      @if (showMobileMenu()) {
        <path d="M6 6l12 12M6 18L18 6" />
      }
    </svg>
  </button>
}

<!-- Overlay for mobile (backdrop) -->
@if (isMobile() && showMobileMenu()) {
  <div
    class="nav-overlay"
    [class.visible]="isMobile() && showMobileMenu()"
    (click)="toggleSidebar()"
  ></div>
}

<!-- Main Navigation Sidebar -->
<nav
  class="nav-sidebar"
  [class.expanded]="isExpanded() || (isMobile() && showMobileMenu())"
  [class.collapsed]="!isExpanded() && !isMobile()"
  [class.mobile]="isMobile()"
  [class.mobile-visible]="isMobile() && showMobileMenu()"
  [class.theme-dark]="config.theme === 'dark'"
  [class.position-right]="config.position === 'right'"
  [class.resizing]="isResizing()"
  [class.collapse-zone]="resizeState() === 'collapse'"
  [class.expand-zone]="resizeState() === 'expand'"
  [style.width.px]="sidebarWidth()"
  role="navigation"
>
  <!-- Desktop Toggle Button (inside sidebar) -->
  @if (!isMobile()) {
    <button
      class="sidebar-toggle"
      [class.visible]="!isMobile()"
      (click)="toggleSidebar()"
      [attr.aria-label]="isExpanded() ? 'Collapse sidebar' : 'Expand sidebar'"
      [attr.aria-expanded]="isExpanded()"
    >
      <svg
        width="20"
        height="20"
        viewBox="0 0 20 20"
        fill="none"
        stroke="currentColor"
        stroke-width="2"
      >
        <path [attr.d]="isExpanded() ? 'M13 4l-6 6 6 6' : 'M7 4l6 6-6 6'" />
      </svg>
    </button>
  }

  <!-- Navigation Items -->
  <ul
    class="nav-list"
    role="list"
  >
    @for (item of config.items; track item.id) {
      <!-- Separator item -->
      @if (item.id.startsWith('separator-') && item.label === '' && item.icon === '') {
        <li
          class="nav-separator"
          role="separator"
        ></li>
      } @else {
        <nav-entry
          [item]="item"
          [showText]="isExpanded() || (isMobile() && showMobileMenu())"
          [isGroupExpanded]="isGroupExpanded(item)"
          [activeWorkContextId]="activeWorkContextId"
          (itemClick)="onItemClick($event)"
        ></nav-entry>
      }
    }
  </ul>

  <!-- Resize Handle -->
  @if (config.resizable && !isMobile()) {
    <div
      class="resize-handle"
      [class.position-left]="config.position !== 'right'"
      [class.position-right]="config.position === 'right'"
      [class.collapsed-handle]="!isExpanded()"
      (mousedown)="onResizeStart($event)"
      [attr.aria-label]="'Resize sidebar'"
      role="separator"
    >
      <div class="resize-handle-line"></div>
    </div>
  }
</nav>
